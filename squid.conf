# ------------------------------------------------------------
# Sacred Cube TMS Squid Proxy Configuration
# ------------------------------------------------------------

# --- Listener ---
http_port 3128

# --- Basic Authentication ---
auth_param basic program /usr/lib/squid/basic_ncsa_auth /etc/squid/passwd
auth_param basic realm SacredCubeTMSProxy
auth_param basic credentialsttl 8 hours
auth_param basic children 5

# --- Access Control Lists ---
acl localnet src 10.0.0.0/8            # RFC1918 possible internal network
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16
acl localnet src fc00::/7               # IPv6 local networks
acl localnet src fe80::/10              # Link-local (directly plugged) machines
acl authenticated proxy_auth REQUIRED

# --- Access Rules (order matters) ---
http_access allow authenticated
http_access allow localhost
# Uncomment if you really want to trust the entire RFC1918 ranges without auth:
# http_access allow localnet
http_access deny all

# --- Header & Forwarding Controls ---
forwarded_for delete
via off
request_header_access X-Forwarded-For deny all
request_header_access Via deny all
request_header_access Cache-Control deny all

# --- Caching ---
cache deny all

# --- Logging ---
access_log /var/log/squid/access.log
cache_log /var/log/squid/cache.log
logfile_rotate 1
cache_store_log none

# --- DNS ---
dns_nameservers 8.8.8.8 8.8.4.4

# --- File Descriptors ---
max_filedescriptors 65535

# --- Stability & Memory Limits ---
cache_mem 64 MB
maximum_object_size_in_memory 256 KB
memory_pools off

# --- Graceful Restart ---
# (systemd handles Restart=always; nothing else needed here)

